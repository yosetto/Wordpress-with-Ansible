---
# tasks file for wordpress
- name: download and extract wordpress in apache2 public directory
  unarchive: 
   src: "https://wordpress.org/latest.tar.gz" 
   dest: "/var/www/html"
   remote_src: yes
  become: true
  
- name: remove default index file from /var/www/html/
  file:
    path: /var/www/html/index.html
    state: absent

- name: move files to /var/www/html/
  command: cp -rf . "/var/www/html/"
  args:
    chdir: "/var/www/html/wordpress/"
    
- name: change ownership of installation directory
  file:
    path: "/var/www/html"
    owner: www-data
    group: www-data
    state: directory
    recurse: yes
  become: true
  
- name: remove wordpress dir
  file:
    path: "/var/www/html/wordpress/"
    state: absent
    
- name: copy wordpress sample config file
  command: 'mv /var/www/html/wp-config-sample.php /var/www/html/wp-config.php creates=/var/www/html/wp-config.php'
  become: true

- name: update wordpress config file
  lineinfile:
   path: "/var/www/html/wp-config.php"
   regexp: '{{ item.regexp }}'
   line: '{{ item.line }}'
  with_items:
   - {'regexp': "define\\('DB_NAME', '(.)+'\\);", 'line': "define('DB_NAME', '{{wp_mysql_db}}');"}
   - {'regexp': "define\\('DB_USER', '(.)+'\\);", 'line': "define('DB_USER', '{{wp_mysql_user}}');"}
   - {'regexp': "define\\('DB_PASSWORD', '(.)+'\\);", 'line': "define('DB_PASSWORD', '{{wp_mysql_password}}');"}
  become: true

