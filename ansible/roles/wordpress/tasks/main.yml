---
# tasks file for wordpress
- name: download and extract wordpress in apache2 public directory
  unarchive: 
   src: "https://wordpress.org/latest.tar.gz" 
   dest: "/var/www/html"
   remote_src: yes
  become: true

- name: copy wordpress sample config file
  command: 'mv /var/www/wordpress/wp-config-sample.php /var/www/wordpress/wp-config.php creates=/var/www/wordpress/wp-config.php'
  become: true

- name: Update wordpress config file
  lineinfile:
   dest:"/var/www/wordpress/wp-config.php"
   regexp:'{{ item.regexp }}'
   line:'{{ item.line }}'
  with_items:
   - {'regexp': "define\\('DB_NAME', '(.)+'\\);", 'line': "define('DB_NAME', '{{wp_mysql_db}}');"}
   - {'regexp': "define\\('DB_USER', '(.)+'\\);", 'line': "define('DB_USER', '{{wp_mysql_user}}');"}
   - {'regexp': "define\\('DB_PASSWORD', '(.)+'\\);", 'line': "define('DB_PASSWORD', '{{wp_mysql_password}}');"}
  become: true

